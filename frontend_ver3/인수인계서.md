# 🔥 FireDrone 모바일 앱 - 인수인계서

## 📋 문서 정보
- **프로젝트명**: FireDrone (React Native - Expo)
- **작성일**: 2024-12-26
- **버전**: v2.0
- **목적**: 드론 화재 감지 시스템 모니터링 앱

---

## 🎯 프로젝트 개요

### 무엇을 하는 앱인가요?
- 드론이 하늘에서 화재를 감지하는 것을 실시간으로 모니터링
- 등록된 드론들의 상태 확인 및 관리
- 감지 이력 조회 및 분석

### 주요 기능
1. ✅ 드론 목록 조회 및 등록
2. ✅ 실시간 모니터링 (GPS, 날씨, 로그, 라이브 포토)
3. ✅ 날짜별 이력 조회
4. ✅ 서버와 실시간 통신

---

## 🚀 빠른 시작 가이드

### 1단계: 환경 설정

#### 필수 요구사항
- **Node.js**: v18 이상 (v24.12.0 권장)
- **npm**: v11 이상
- **Expo CLI**: 프로젝트에 포함됨
- **모바일 기기** (iOS/Android) 또는 **에뮬레이터**

#### 설치 확인
```bash
node --version    # v18 이상이어야 함
npm --version     # v11 이상이어야 함
```

#### Node.js 설치 (없는 경우)
**Windows (winget 사용)**:
```powershell
winget install OpenJS.NodeJS.LTS
```

**또는 공식 사이트에서 다운로드**:
- https://nodejs.org/

---

### 2단계: 프로젝트 설정

#### 디렉토리 이동
```bash
cd firedrone
```

#### 의존성 설치
```bash
npm install
```

#### 추가 라이브러리 설치 (이미 설치됨)
```bash
npx expo install react-native-safe-area-context react-native-screens @react-navigation/native @react-navigation/bottom-tabs @react-navigation/native-stack lucide-react-native expo-notifications expo-status-bar expo-av expo-location expo-linear-gradient
```

---

### 3단계: 서버 설정 (옵션)

#### 백엔드 서버 주소 설정
`src/utils/api.js` 파일을 열어서 API 주소를 수정하세요:

```javascript
const API_BASE_URL = __DEV__ 
  ? 'http://localhost:3000/api'  // 개발 환경 (현재 컴퓨터 주소)
  : 'https://your-server.com/api'; // 프로덕션 환경
```

**중요**: 
- 로컬 네트워크 사용 시: `http://[본인IP]:3000/api` (예: `http://192.168.0.100:3000/api`)
- 서버가 없어도 앱은 모의 데이터로 작동합니다

---

### 4단계: 앱 실행

#### 개발 서버 시작
```powershell
# PowerShell에서 Node.js 경로 추가 (필요 시)
$env:Path += ";C:\Program Files\nodejs"

# Expo 시작
cd firedrone
npx expo start
```

**또는 npm 스크립트 사용**:
```bash
npm start
```

#### 실행 옵션
터미널에 QR 코드가 나타나면:

1. **모바일 기기에서 실행** (권장)
   - Expo Go 앱 설치 (iOS/Android)
   - QR 코드 스캔

2. **웹 브라우저에서 실행**
   - 터미널에서 `w` 키 입력

3. **에뮬레이터에서 실행**
   - Android: 터미널에서 `a` 키 입력
   - iOS (Mac만): 터미널에서 `i` 키 입력

---

## 📁 프로젝트 구조

```
firedrone/
├── App.js                    # 메인 앱 진입점 (네비게이션 설정)
├── index.js                  # Expo 진입점
├── package.json              # 프로젝트 의존성
├── app.json                  # Expo 설정
│
├── src/
│   ├── screens/              # 화면 컴포넌트
│   │   ├── DroneListScreen.js      # 드론 목록 화면
│   │   ├── MonitoringScreen.js     # 모니터링 화면
│   │   └── InquiryScreen.js        # 이력 조회 화면
│   │
│   ├── components/           # 재사용 컴포넌트
│   │   ├── BatteryIcon.js          # 배터리 아이콘
│   │   ├── DetectionCard.js        # 감지 카드
│   │   └── DetectionDetailModal.js # 상세 정보 모달
│   │
│   ├── navigation/           # 네비게이션 설정
│   │   └── MainTabNavigator.js     # 탭 네비게이션
│   │
│   └── utils/                # 유틸리티 함수
│       ├── api.js            # API 통신 함수 ⚠️ 중요
│       ├── mockData.js       # 모의 데이터
│       ├── notifications.js  # 알림 기능
│       └── weather.js        # 기상 데이터 처리
│
├── assets/                   # 이미지, 아이콘 등
└── components/               # Expo 기본 컴포넌트
```

---

## 🔌 API 연동 가이드

### API 서버 엔드포인트

모든 API는 `src/utils/api.js` 파일에 정의되어 있습니다.

#### 주요 API 함수

1. **드론 목록 조회**
```javascript
fetchDroneList()
// GET /api/drones
// 반환: 드론 배열 또는 null
```

2. **드론 등록**
```javascript
registerDrone({ drone_name, drone_lat, drone_lon })
// POST /api/register
// 반환: { drone_db_id, drone_name, ... }
```

3. **접속 시간 업데이트**
```javascript
updateDroneConnectTime(droneName)
// POST /api/drones/:drone_name/connect
```

4. **드론 로그 조회**
```javascript
fetchDroneLogs(droneName, date)
// GET /api/logs/:drone_name?date=YYYY-MM-DD
```

5. **라이브 포토 조회**
```javascript
fetchLivePhotos(droneName)
// GET /api/drones/:drone_name/live-photos
```

### API 응답 구조

모든 API는 다음 구조를 따릅니다:

```javascript
// 성공 시
{
  success: true,
  data: {
    // 실제 데이터
  }
}

// 실패 시
{
  success: false,
  message: "에러 메시지"
}
```

### 서버가 없는 경우

- 서버 연결 실패 시 자동으로 `mockData.js`의 모의 데이터 사용
- 앱이 멈추지 않고 계속 작동

---

## 🎨 주요 화면 설명

### 1. DroneListScreen (드론 목록)

**경로**: `src/screens/DroneListScreen.js`

**기능**:
- 등록된 드론 목록 표시
- 새 드론 등록 (이름만 입력)
- 드론 선택 시 모니터링 화면으로 이동
- 5초마다 자동 새로고침

**주요 상태**:
- `drones`: 드론 목록 배열
- `isModalVisible`: 등록 모달 표시 여부
- `isLoading`: 로딩 상태

---

### 2. MonitoringScreen (모니터링)

**경로**: `src/screens/MonitoringScreen.js`

**기능**:
- 실시간 GPS 정보 표시
- 날씨 정보 (풍속, 습도)
- 실시간 영상 스트리밍 (준비 중)
- 최신 화재 감지 알림
- 라이브 포토 갤러리
- 1초마다 자동 새로고침

**주요 상태**:
- `logs`: 감지 로그 배열
- `livePhotos`: 라이브 포토 배열
- `location`: GPS 좌표
- `weather`: 날씨 정보

---

### 3. InquiryScreen (조회)

**경로**: `src/screens/InquiryScreen.js`

**기능**:
- 날짜 선택 (달력)
- 선택한 날짜의 감지 이력 조회
- 이미지와 확률 표시
- 상세 정보 모달

**주요 상태**:
- `selectedDate`: 선택한 날짜
- `filteredHistory`: 필터링된 이력 배열
- `isLoading`: 로딩 상태

---

## ⚙️ 설정 및 환경 변수

### API 주소 설정

**파일**: `src/utils/api.js`

```javascript
const API_BASE_URL = __DEV__ 
  ? 'http://localhost:3000/api'  // 개발 환경
  : 'https://your-server.com/api'; // 프로덕션 환경
```

**로컬 네트워크 사용 시**:
```javascript
const API_BASE_URL = 'http://192.168.0.100:3000/api';  // 본인 IP 주소
```

### 네비게이션 설정

**파일**: `App.js`

```javascript
<Stack.Navigator
  initialRouteName="MainTabs"  // 시작 화면
  screenOptions={{
    headerShown: false,
    animation: 'slide_from_right',
  }}
>
```

### 탭 네비게이션 설정

**파일**: `src/navigation/MainTabNavigator.js`

현재 2개의 탭:
- **Monitor**: 드론 목록 화면
- **History**: 이력 조회 화면

---

## 🔧 문제 해결 (Troubleshooting)

### 문제 1: `npx` 명령어를 찾을 수 없음

**증상**:
```
npx : 'npx' 용어가 cmdlet, 함수, 스크립트 파일 또는 실행할 수 있는 프로그램 이름으로 인식되지 않습니다.
```

**해결 방법**:
```powershell
# Node.js 경로 추가
$env:Path += ";C:\Program Files\nodejs"

# 또는 터미널을 완전히 닫고 다시 열기
```

---

### 문제 2: PowerShell 실행 정책 오류

**증상**:
```
npx : 이 시스템에서 스크립트를 실행할 수 없으므로 C:\Program Files\nodejs\npx.ps1 파일을 로드할 수 없습니다.
```

**해결 방법 1**: npx.cmd 직접 사용
```powershell
& "C:\Program Files\nodejs\npx.cmd" expo start
```

**해결 방법 2**: 실행 정책 변경 (관리자 권한 필요)
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

---

### 문제 3: Expo 서버가 시작되지 않음

**증상**: `TypeError: Body is unusable: Body has already been read`

**해결 방법**:
```bash
# 캐시 클리어
npm cache clean --force

# node_modules 재설치
rm -rf node_modules
npm install

# Expo 캐시 클리어 후 시작
npx expo start --clear
```

---

### 문제 4: API 연결 실패

**증상**: 드론 목록이 비어있거나 데이터가 안 나옴

**해결 방법**:
1. 서버가 실행 중인지 확인
2. `src/utils/api.js`의 API_BASE_URL 확인
3. 네트워크 연결 확인
4. 모의 데이터로 작동하는지 확인 (정상 동작)

---

### 문제 5: 모바일 기기에서 연결 안 됨

**증상**: QR 코드 스캔 후 연결 실패

**해결 방법**:
1. 모바일과 컴퓨터가 같은 Wi-Fi에 연결되어 있는지 확인
2. 방화벽 설정 확인
3. `--tunnel` 옵션 사용:
```bash
npx expo start --tunnel
```

---

## 📦 의존성 관리

### 주요 패키지

```json
{
  "expo": "~54.0.30",
  "react": "19.1.0",
  "react-native": "0.81.5",
  "@react-navigation/native": "^7.1.26",
  "@react-navigation/bottom-tabs": "^7.9.0",
  "@react-navigation/native-stack": "^7.9.0",
  "lucide-react-native": "^0.562.0",
  "expo-location": "~19.0.8",
  "expo-notifications": "~0.32.15",
  "expo-av": "~16.0.8"
}
```

### 패키지 업데이트

```bash
# 모든 패키지 업데이트
npm update

# Expo SDK 업데이트
npx expo install --fix

# 특정 패키지 업데이트
npm install 패키지명@latest
```

---

## 🔐 보안 및 배포

### 개발 환경 vs 프로덕션 환경

**개발 환경** (`__DEV__ = true`):
- 모의 데이터 사용 가능
- 디버그 로그 표시
- 로컬 서버 연결

**프로덕션 환경** (`__DEV__ = false`):
- 실제 서버만 연결
- 디버그 로그 비활성화
- 최적화된 빌드

### 배포 전 체크리스트

- [ ] API 서버 주소 확인
- [ ] 환경 변수 설정 확인
- [ ] 빌드 오류 확인
- [ ] 테스트 완료
- [ ] 보안 취약점 점검

---

## 📝 개발 가이드

### 새 기능 추가하기

1. **새 화면 추가**
   - `src/screens/` 디렉토리에 파일 생성
   - `App.js` 또는 `MainTabNavigator.js`에 라우트 추가

2. **새 API 함수 추가**
   - `src/utils/api.js`에 함수 추가
   - 응답 구조 확인 (`{success, data}`)

3. **새 컴포넌트 추가**
   - `src/components/` 디렉토리에 파일 생성
   - 재사용 가능하도록 설계

### 코딩 스타일

- **네이밍**: camelCase 사용
- **컴포넌트**: PascalCase 사용
- **상수**: UPPER_SNAKE_CASE 사용
- **주석**: 한국어 또는 영어

---

## 🔄 버전 관리

### Git 사용 시

```bash
# 초기 커밋
git init
git add .
git commit -m "Initial commit"

# .gitignore 확인 (node_modules, .expo 등 제외)
```

### 주요 브랜치 전략

- `main`: 프로덕션 버전
- `develop`: 개발 버전
- `feature/*`: 기능 개발

---

## 📞 연락처 및 지원

### 문서 참고
- `프로젝트_개요서.md`: 프로젝트 전체 개요
- `차이점_비교표.md`: 기존 버전과의 차이점
- `작업자_가이드.md`: 상세 개발 가이드

### 문제 발생 시
1. 이 인수인계서의 "문제 해결" 섹션 확인
2. Expo 공식 문서 확인: https://docs.expo.dev/
3. React Navigation 문서 확인: https://reactnavigation.org/

---

## ✅ 체크리스트

### 인수 받는 사람이 확인할 사항

- [ ] Node.js 설치 확인 (v18 이상)
- [ ] `npm install` 실행 완료
- [ ] `npx expo start` 실행 성공
- [ ] 모바일 기기 또는 에뮬레이터에서 앱 실행 확인
- [ ] API 서버 주소 설정 확인
- [ ] 주요 기능 동작 확인:
  - [ ] 드론 목록 표시
  - [ ] 드론 등록
  - [ ] 모니터링 화면
  - [ ] 이력 조회

---

## 📊 프로젝트 현황

### 완료된 기능 ✅
- 드론 목록 조회 (서버 연동)
- 드론 등록 (이름만 입력, ID 자동 생성)
- 실시간 모니터링 (GPS, 날씨, 로그)
- 라이브 포토 갤러리
- 날짜별 이력 조회
- 자동 새로고침 (5초/1초)
- 접속 시간 추적

### 향후 개선 가능한 부분
- [ ] 실시간 영상 스트리밍 재생 (현재는 URL만 표시)
- [ ] 푸시 알림 기능 개선
- [ ] 오프라인 모드 지원
- [ ] 데이터 캐싱 최적화
- [ ] 에러 처리 강화

---

## 🎓 학습 자료

### React Native & Expo
- Expo 공식 문서: https://docs.expo.dev/
- React Native 문서: https://reactnative.dev/
- Expo Snack (온라인 에디터): https://snack.expo.dev/

### React Navigation
- 공식 문서: https://reactnavigation.org/
- 예제 코드: https://reactnavigation.org/docs/hello-react-navigation

### 유용한 도구
- Expo Go 앱 (모바일): App Store / Play Store
- React Native Debugger: 디버깅 도구
- Flipper: 개발자 도구

---

## 📌 중요 참고사항

1. **서버 연동 필수 아님**: 서버가 없어도 모의 데이터로 작동
2. **자동 새로고침**: 목록은 5초, 로그는 1초마다 자동 갱신
3. **디자인 유지**: 기존 디자인은 그대로 유지하며 기능만 추가
4. **API 구조**: 모든 API는 `{success, data}` 구조 사용
5. **드론 이름 기반**: 대부분의 API가 드론 이름(drone_name) 기반

---

## 🎉 마무리

이 문서를 통해 프로젝트를 성공적으로 인수받고 개발을 이어갈 수 있습니다.

**궁금한 점이 있으면 이 문서를 먼저 확인하세요!**

**행운을 빕니다! 🚀**

